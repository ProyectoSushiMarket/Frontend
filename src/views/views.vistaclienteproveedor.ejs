<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clientes de Tienda de Verduras</title>
    <link rel="stylesheet" href="/css/vistaclienteproveedor.css">
</head>
<body>
    <header>
        <div class="navbar">
            <h1>Tienda Verduras</h1>
            <nav>
                <a href="/principalproveedor">Tienda</a>
                <a href="https://wa.me/+573188342212">Contactanos</a>
                <span class="perfil">游녻 Perfil: <strong>PROVEEDOR</strong></span>
            </nav>
        </div>
    </header>
    <main>
        <h2>Lista de Clientes</h2>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Buscar cliente..." />
            <button class="crearcliente" onclick="abrirModal()">Crear Cliente</button>
        </div>
        <table id="clientesTabla">
            <thead>
                <tr>
                    <th>ID Usuario</th>
                    <th>Nombre</th>
                    <th>Usuario</th>
                    <th>Rol</th>
                    <th>Editar/Eliminar</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </main>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            
            const apiUrl = "http://localhost:4100/usuario";

            
            const tbody = document.querySelector("#clientesTabla tbody");

            
            async function obtenerClientes() {
                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) {
                        throw new Error("Error al obtener los datos");
                    }
                    const clientes = await response.json();

                    
                    tbody.innerHTML = "";

                    
                    clientes.forEach(cliente => {
                        const fila = document.createElement("tr");

                        fila.innerHTML = `
                            <td>${cliente.id_usuario}</td>
                            <td>${cliente.nombre}</td>
                            <td>${cliente.usuario}</td>
                            <td>${cliente.rol}</td>
                        `;

                        tbody.appendChild(fila);
                    });
                } catch (error) {
                    console.error("Error al cargar los clientes:", error);
                }
            }

            
            obtenerClientes();
            
        });
    </script>
    <!-- Modal para agregar cliente -->
    <div id="add-cliente-modal" class="add-cliente-modal">
        <div class="add-cliente-modal-content">
            <div class="add-cliente-modal-header">Crear Cliente</div>
            <div class="add-cliente-modal-body">
                <form id="cliente-form">
                    <label for="cliente-nombre">Nombre del cliente:</label>
                    <input type="text" id="cliente-nombre" name="cliente-nombre" placeholder="Ingresa el nombre">
            
                    <label for="cliente-usuario">Usuario:</label>
                    <input type="text" id="cliente-usuario" name="cliente-usuario" placeholder="Ingresa el usuario">

                    <label for="cliente-contrasena">Contrase침a:</label>
                    <input type="password" id="cliente-contrasena" name="cliente-contrasena" placeholder="Ingresa la Contrase침a">
                        
                    <label for="cliente-rol">Rol:</label>
                    <input type="text" id="cliente-rol" name="cliente-rol" placeholder="Ingresa el rol">
                </form>
            </div>
            <div class="add-cliente-modal-actions">
                <button class="save-cliente-button" onclick="guardarCambios()">Guardar</button>
                <button class="cancel-cliente-button" onclick="cerrarModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // Funci칩n para abrir el modal
        function abrirModal() {
                document.getElementById("add-cliente-modal").style.display = "flex";
            }

            // Funci칩n para cerrar el modal
            function cerrarModal() {
                document.getElementById("add-cliente-modal").style.display = "none";
            }
            // Funci칩n para guardar el producto
            function guardarCambios() {
                // Capturar los valores directamente desde el formulario
                const nombre = document.getElementById("cliente-nombre").value;
                const usuario = document.getElementById("cliente-usuario").value;
                const contrasena = document.getElementById("cliente-contrasena").value;
                const rol = document.getElementById("cliente-rol").value;

                
                const datos = {
                    nombre: nombre,
                    usuario: usuario,
                    contrasena: contrasena,
                    rol: rol
                };

                // Enviar los datos al backend
                fetch('http://localhost:4100/usuario', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(datos),
                })
                    .then((response) => {
                        if (!response.ok) {
                            throw new Error('Error al guardar los datos');
                        }
                        return response.json();
                    })
                    .then((data) => {
                        console.log('Cliente creado con 칠xito:', data)
                        alert("Cliente Agregado")
                        cerrarModal();
                        location.reload(); // Recarga la p치gina autom치ticamente
                    })
                    .catch((error) => {
                        console.error('Error al crear el usuario:', error);
                        alert('No se pudo crear el usuario');
                    });
            }
    </script>

    <script src="/js/vistaclienteproveedor.js"></script>
</body>
</html>
